<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}SGT{% endblock %}</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <!-- Bootstrap 5 -->
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

    <!-- DataTables + Bootstrap 5 + Responsive -->
    <link rel="stylesheet"
          href="https://cdn.datatables.net/1.13.7/css/dataTables.bootstrap5.min.css">
    <link rel="stylesheet"
          href="https://cdn.datatables.net/responsive/2.5.0/css/responsive.bootstrap5.min.css">

    <!-- Font Awesome -->
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
          integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
          crossorigin="anonymous" referrerpolicy="no-referrer" />

    <style>
/* ==========================================================
   SGT • PREMIUM UI ✅ (BASE COMPLETE)
   - Sidebar + Topbar premium
   - Cards/Tables/Forms professional
   - Modal NO SHAKE ✅
   - Compact Tables ✅
   ========================================================== */

:root{
  --bg: #f3f6fb;
  --surface: #ffffff;
  --text: #0f172a;
  --muted:#64748b;

  --border:#e6eef9;
  --border2:#dbe7f6;

  --shadow: 0 18px 40px rgba(15, 23, 42, .10);
  --shadow2: 0 10px 20px rgba(15, 23, 42, .06);

  --radius: 18px;
  --radius2: 14px;

  --c1:#2563eb;
  --c2:#7c3aed;
  --c3:#f59e0b;
  --c4:#06b6d4;
  --c5:#16a34a;
  --c6:#ef4444;

  --topbarH: 64px;
  --sidebarW: 270px;
  --sidebarCollapsedW: 78px;
}

/* ✅ FIX MODAL SHAKE (Scrollbar stable) */
html{ overflow-y: scroll; }
body.modal-open{
  overflow: hidden !important;
  padding-right: 0 !important; /* stop bootstrap padding jump */
}

/* Prevent layout shifts */
*{ box-sizing:border-box; }
html,body{ height:100%; }

body{
  margin:0;
  min-height:100vh;
  color:var(--text);
  background:
    radial-gradient(1000px 600px at 15% 0%, rgba(37,99,235,.08), transparent 55%),
    radial-gradient(1000px 600px at 90% 0%, rgba(6,182,212,.06), transparent 55%),
    var(--bg);
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", sans-serif;
}

a{ color:inherit; text-decoration:none; }
a:hover{ opacity:.96; }

/* =========================
   Layout
   ========================= */
.layout-wrapper{
  display:flex;
  min-height:100vh;
}

/* =========================
   Sidebar
   ========================= */
.sidebar{
  width: var(--sidebarW);
  background: linear-gradient(180deg, #0f172a, #111827);
  color:#fff;
  transition: all .25s ease;
  display:flex;
  flex-direction:column;
  border-right: 1px solid rgba(255,255,255,.08);
  box-shadow: 0 18px 30px rgba(0,0,0,.22);
}

.sidebar.collapsed{ width: var(--sidebarCollapsedW); }

.sidebar-header{
  padding: 18px 16px;
  font-weight: 900;
  font-size: 1rem;
  border-bottom: 1px solid rgba(255,255,255,.10);
  display:flex;
  align-items:center;
  gap:.75rem;
}

.sidebar-header i{
  width: 44px;
  height: 44px;
  display:grid;
  place-items:center;
  border-radius: 14px;
  background: linear-gradient(135deg, var(--c1), var(--c4));
  box-shadow: 0 14px 24px rgba(37,99,235,.25);
  font-size: 1.2rem;
}

.sidebar .nav-section-title{
  padding: 12px 16px 6px;
  font-size: .72rem;
  text-transform: uppercase;
  letter-spacing: .12em;
  opacity: .70;
}

.sidebar .nav-link{
  color: rgba(255,255,255,.92);
  margin: 6px 10px;
  padding: 12px 12px;
  font-size: .95rem;
  display:flex;
  align-items:center;
  gap:.70rem;
  border-radius: 16px;
  transition: .18s ease;
  border: 1px solid rgba(255,255,255,.06);
  background: rgba(255,255,255,.04);
}

.sidebar .nav-link i{
  width: 22px;
  text-align:center;
  opacity:.95;
}

.sidebar .nav-link:hover{
  transform: translateY(-1px);
  background: rgba(255,255,255,.08);
  border-color: rgba(255,255,255,.12);
}

.sidebar .nav-link.active{
  background: linear-gradient(135deg, rgba(37,99,235,.35), rgba(6,182,212,.18));
  border-color: rgba(37,99,235,.35);
  box-shadow: 0 14px 22px rgba(0,0,0,.20);
}

.sidebar.collapsed .nav-link span.label-text,
.sidebar.collapsed .nav-section-title,
.sidebar.collapsed .sidebar-header span.brand-text{
  display:none;
}
.sidebar.collapsed .sidebar-header{ justify-content:center; }
.sidebar.collapsed .nav-link{ justify-content:center; }

.sidebar .mt-auto{
  background: rgba(255,255,255,.03);
  border-top: 1px solid rgba(255,255,255,.08) !important;
}

/* =========================
   Content + Topbar
   ========================= */
.content-area{
  flex:1;
  display:flex;
  flex-direction:column;
  min-width:0;
  background:
    linear-gradient(180deg, rgba(255,255,255,.75), rgba(255,255,255,0)),
    var(--bg);
}

.top-navbar{
  background: rgba(255,255,255,.82);
  border-bottom: 1px solid var(--border);
  backdrop-filter: blur(12px);
}

.top-navbar .navbar-brand{
  font-weight: 950;
  letter-spacing: -.3px;
  color: var(--text);
}

/* Toggle btn */
#sidebarToggle{
  border-radius: 12px !important;
  padding: 7px 10px !important;
  font-size: .9rem !important;
  border: 1px solid var(--border2) !important;
  background: #fff !important;
  color: var(--text) !important;
  box-shadow: var(--shadow2);
  transition:.18s ease;
}
#sidebarToggle:hover{ transform: translateY(-1px); }

/* Main content container */
.main-content{
  padding: 1.6rem 1.6rem 2rem;
  max-width: 1280px;
  width:100%;
  margin: 0 auto;
}

/* Titles */
.main-content h1,
.main-content h2{
  font-weight: 950 !important;
  letter-spacing: -0.9px;
  color: var(--text);
}
.main-content h2{
  font-size: 2.1rem !important;
  margin-bottom: 16px !important;
}

/* Gutters */
.main-content .row{
  --bs-gutter-x: 18px;
  --bs-gutter-y: 18px;
}

/* =========================
   Buttons
   ========================= */
.btn{
  border-radius: 12px !important;
  font-weight: 800 !important;
  letter-spacing:.2px;
  padding: 8px 14px !important;
  font-size: .92rem !important;
  transition: .18s ease;
}
.btn:hover{ transform: translateY(-1px); }

.btn-sm{
  padding: 6px 10px !important;
  font-size: .82rem !important;
  border-radius: 10px !important;
}

.btn-primary{
  border:none !important;
  background: linear-gradient(135deg, var(--c1), var(--c4)) !important;
  box-shadow: 0 14px 22px rgba(37,99,235,.18);
}
.btn-primary:hover{ filter: brightness(1.03); }

.btn-warning{
  border:none !important;
  color:#111827 !important;
  background: linear-gradient(135deg, #fbbf24, #f59e0b) !important;
}
.btn-danger{
  border:none !important;
  background: linear-gradient(135deg, #ef4444, #fb7185) !important;
}
.btn-success{
  border:none !important;
  background: linear-gradient(135deg, #16a34a, #22c55e) !important;
}
.btn-info{
  border:none !important;
  background: linear-gradient(135deg, #0ea5e9, #06b6d4) !important;
  color:#fff !important;
}

/* =========================
   Alerts
   ========================= */
.alert{
  border-radius: var(--radius2);
  border: 1px solid var(--border);
  box-shadow: var(--shadow2);
  background: #fff;
}

/* =========================
   Cards
   ========================= */
.card{
  position: relative;
  border: 1px solid var(--border) !important;
  border-radius: var(--radius) !important;
  background: var(--surface) !important;
  box-shadow: var(--shadow2) !important;
  overflow:hidden;
  transition:.18s ease;
}

.card:hover{
  transform: translateY(-2px);
  box-shadow: var(--shadow) !important;
}

.card .card-body{
  padding: 18px 18px 18px 18px !important;
  min-height: 105px;
}

.card .card-title{
  font-weight: 900 !important;
  font-size: .98rem !important;
  color: #334155 !important;
  margin-bottom: 8px !important;
}

.card .display-6,
.card h2,
.card h3{
  font-weight: 950 !important;
  color: var(--text) !important;
}

/* ✅ Make KPI (text-bg-*) look premium */
.card.text-bg-primary,
.card.text-bg-success,
.card.text-bg-warning,
.card.text-bg-info,
.card.text-bg-secondary{
  color: var(--text) !important;
  background: #fff !important;
}

.card.text-bg-primary::before,
.card.text-bg-success::before,
.card.text-bg-warning::before,
.card.text-bg-info::before,
.card.text-bg-secondary::before{
  content:"";
  position:absolute;
  top:14px;
  bottom:14px;
  left:14px;
  width:6px;
  border-radius:999px;
  opacity:.95;
}

.card.text-bg-primary::before{ background: linear-gradient(180deg, var(--c1), var(--c4)); }
.card.text-bg-success::before{ background: linear-gradient(180deg, #16a34a, #22c55e); }
.card.text-bg-warning::before{ background: linear-gradient(180deg, #f59e0b, #f97316); }
.card.text-bg-info::before{ background: linear-gradient(180deg, #0ea5e9, #06b6d4); }
.card.text-bg-secondary::before{ background: linear-gradient(180deg, #475569, #94a3b8); }

.card.text-bg-primary .card-body,
.card.text-bg-success .card-body,
.card.text-bg-warning .card-body,
.card.text-bg-info .card-body,
.card.text-bg-secondary .card-body{
  padding-left: 28px !important;
}

/* =========================
   Forms / Inputs
   ========================= */
.form-control, .form-select, textarea{
  border-radius: 12px !important;
  border: 1px solid var(--border2) !important;
  background: #fff !important;
  box-shadow: none !important;
}

.form-control:focus, .form-select:focus, textarea:focus{
  border-color: rgba(37,99,235,.55) !important;
  box-shadow: 0 0 0 4px rgba(37,99,235,.12) !important;
}

/* =========================
   Tables + DataTables
   ========================= */
.table{
  color: var(--text) !important;
  background: #fff;
  border-radius: var(--radius);
  overflow:hidden;
}

.table thead th{
  background: #f2f6ff !important;
  color: #334155 !important;
  border-color: var(--border) !important;
  font-size: .85rem;
  font-weight: 900;
}

.table td, .table th{
  border-color: var(--border) !important;
  vertical-align: middle;
}

.table-hover tbody tr{
  transition:.18s ease;
}
.table-hover tbody tr:hover{
  background: #f7faff !important;
}

/* DataTables controls */
.dataTables_wrapper .dataTables_filter input,
.dataTables_wrapper .dataTables_length select{
  border-radius: 14px !important;
  border: 1px solid var(--border2) !important;
  background: #fff !important;
  color: var(--text) !important;
  padding: 8px 10px !important;
  outline:none !important;
  box-shadow: 0 8px 16px rgba(15, 23, 42, .05);
}

.dataTables_wrapper .dataTables_info{
  color: var(--muted) !important;
  font-weight: 600;
}

.page-link{
  background:#fff !important;
  border-color: var(--border2) !important;
  color: var(--text) !important;
  border-radius: 12px !important;
}
.page-item.active .page-link{
  background: linear-gradient(135deg, var(--c1), var(--c4)) !important;
  border:none !important;
  color:#fff !important;
}

/* =========================
   ✅ Compact table mode
   (add class "compact" to table)
   ========================= */
.table.compact td,
.table.compact th{
  padding: 8px 10px !important;
  font-size: 0.90rem !important;
}

.table.compact thead th{
  padding: 10px 10px !important;
  font-size: 0.82rem !important;
}

.table.compact .btn-sm{
  padding: 5px 8px !important;
  font-size: 0.75rem !important;
  border-radius: 10px !important;
}

.table.compact .badge{
  padding: 5px 8px !important;
  font-size: 0.72rem !important;
}

/* =========================
   Modal ✅ (NO SHAKE + small)
   ========================= */
.modal-dialog{
  max-width: 850px !important;
  margin: 1rem auto !important;
}

.modal-content{
  border-radius: 18px !important;
  border: 1px solid rgba(15,23,42,.10) !important;
  overflow: hidden !important;
  box-shadow: var(--shadow) !important;
}

.modal-header{
  background: rgba(255,255,255,.92) !important;
  border-bottom: 1px solid var(--border) !important;
}

.modal-body{
  display:flex;
  justify-content:center;
  align-items:center;
  overflow:hidden !important;
  background: #fff !important;
}

.modal-body img{
  max-height: 65vh !important;
  max-width: 100% !important;
  object-fit: contain !important;
  display:block !important;
}

/* ✅ Kill Bootstrap transform animation (prevents jitter) */
.modal.fade .modal-dialog{
  transition: none !important;
  transform: none !important;
}

/* =========================
   Mobile overlay
   ========================= */
.mobile-overlay{
  position: fixed;
  inset: 0;
  background: rgba(15,23,42,.40);
  z-index: 1035;
  display:none;
}
.mobile-overlay.active{ display:block; }

/* =========================
   Desktop fixed sidebar + fixed topbar
   ========================= */
@media (min-width: 769px){
  .sidebar{
    position: fixed;
    top:0;
    left:0;
    height:100vh;
    overflow-y:auto;
    z-index:1040;
  }

  .content-area{ margin-left: var(--sidebarW); }
  .sidebar.collapsed ~ .content-area{ margin-left: var(--sidebarCollapsedW); }

  .top-navbar{
    position: fixed;
    top:0;
    left: var(--sidebarW);
    right:0;
    z-index:1030;
    height: var(--topbarH);
    display:flex;
    align-items:center;
    box-shadow: var(--shadow2);
  }

  .sidebar.collapsed ~ .content-area .top-navbar{
    left: var(--sidebarCollapsedW);
  }

  .main-content{
    padding-top: calc(var(--topbarH) + 1.2rem);
  }
}

/* =========================
   Mobile
   ========================= */
@media (max-width: 768px){
  .sidebar{
    position: fixed;
    z-index:1040;
    height:100vh;
    left:0;
    top:0;
    width: var(--sidebarW);
    transform: translateX(0);
  }
  .sidebar.hidden-mobile{ transform: translateX(-110%); }
  .content-area{ margin-left:0; }
  .top-navbar{
    position: sticky;
    top:0;
    z-index:1030;
  }
}
    </style>
</head>
<body>

<div class="layout-wrapper" id="layoutWrapper">

    <!-- Sidebar -->
    <nav class="sidebar hidden-mobile" id="sidebar">
        <div class="sidebar-header">
            <i class="fa-solid fa-bus-simple"></i>
            <span class="brand-text">SGT - Transport</span>
        </div>

        <div class="nav flex-column mt-2">
            <div class="nav-section-title">Navigation</div>

            <a href="{% url 'dashboard' %}" class="nav-link">
                <i class="fa-solid fa-gauge-high"></i>
                <span class="label-text">Tableau de bord</span>
            </a>

            <a href="{% url 'liste_trajets' %}" class="nav-link">
                <i class="fa-solid fa-route"></i>
                <span class="label-text">Trajets</span>
            </a>

            <a href="{% url 'liste_vehicules' %}" class="nav-link">
                <i class="fa-solid fa-truck-front"></i>
                <span class="label-text">Véhicules</span>
            </a>

            <a href="{% url 'liste_chauffeurs' %}" class="nav-link">
                <i class="fa-solid fa-id-card-clip"></i>
                <span class="label-text">Chauffeurs</span>
            </a>

            <a href="{% url 'liste_voyages' %}" class="nav-link">
                <i class="fa-solid fa-ticket-alt"></i>
                <span class="label-text">Voyages</span>
            </a>

            <a href="{% url 'liste_reservations' %}" class="nav-link">
                <i class="fa-solid fa-clipboard-list"></i>
                <span class="label-text">Réservations</span>
            </a>

            <a href="{% url 'liste_clients' %}" class="nav-link">
                <i class="fa-solid fa-user-group"></i>
                <span class="label-text">Clients</span>
            </a>

            {% if user.is_superuser %}
                <div class="nav-section-title">Administration</div>
                <a href="{% url 'gestion_comptes' %}" class="nav-link">
                    <i class="fa-solid fa-user-shield"></i>
                    <span class="label-text">Gestion des comptes</span>
                </a>
                <a href="/admin/" class="nav-link">
                    <i class="fa-solid fa-toolbox"></i>
                    <span class="label-text">Django Admin</span>
                </a>
            {% endif %}
        </div>

        {% if user.is_authenticated %}
            <div class="mt-auto py-3 px-3 border-top border-light-subtle small">
                <div class="d-flex align-items-center justify-content-between">
                    <span>
                        <i class="fa-regular fa-circle-user me-1"></i>
                        {{ user.username }}
                    </span>
                    <a href="{% url 'logout' %}" class="text-light text-decoration-none">
                        <i class="fa-solid fa-right-from-bracket"></i>
                    </a>
                </div>
            </div>
        {% endif %}
    </nav>

    <!-- Overlay (Mobile) -->
    <div class="mobile-overlay" id="mobileOverlay"></div>

    <!-- Content -->
    <div class="content-area">

        <!-- Top Navbar -->
        <nav class="navbar top-navbar px-3">
            <div class="d-flex align-items-center w-100">
                <button id="sidebarToggle" class="btn btn-outline-primary btn-sm me-3">
                    <i class="fa-solid fa-bars"></i>
                </button>

                <span class="navbar-brand mb-0">
                    {% block header_title %}{% endblock %}
                </span>

                <div class="ms-auto d-flex align-items-center">
                    {% if user.is_authenticated %}
                        <span class="me-3 d-none d-md-inline">
                            Bonjour, <strong>{{ user.username }}</strong>
                        </span>
                    {% else %}
                        <a href="{% url 'login' %}" class="btn btn-sm btn-primary">
                            Connexion
                        </a>
                    {% endif %}
                </div>
            </div>
        </nav>

        <main class="main-content">

            {% if messages %}
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                {% endfor %}
            {% endif %}

            {% block content %}{% endblock %}
        </main>
    </div>
</div>

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- ✅ FIX Modal shake by forcing body scrollbar always */
<script>
  document.addEventListener("show.bs.modal", function () {
    document.documentElement.style.overflowY = "scroll";
    document.body.style.paddingRight = "0px";
  });
</script>

<!-- DataTables JS + Bootstrap 5 + Responsive -->
<script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js"></script>
<script src="https://cdn.datatables.net/responsive/2.5.0/js/dataTables.responsive.min.js"></script>
<script src="https://cdn.datatables.net/responsive/2.5.0/js/responsive.bootstrap5.min.js"></script>

<script>
    // ✅ DataTables init
    $(document).ready(function () {
        $('table.datatable').DataTable({
            responsive: true,
            language: {
                url: 'https://cdn.datatables.net/plug-ins/1.13.7/i18n/fr-FR.json'
            }
        });
    });

    // ✅ Toggle sidebar + overlay
    document.addEventListener('DOMContentLoaded', function () {
        const sidebar = document.getElementById('sidebar');
        const toggleBtn = document.getElementById('sidebarToggle');
        const overlay = document.getElementById('mobileOverlay');

        function toggleSidebar() {
            if (window.innerWidth <= 768) {
                sidebar.classList.toggle('hidden-mobile');
                const isOpen = !sidebar.classList.contains('hidden-mobile');
                if (isOpen) overlay.classList.add('active');
                else overlay.classList.remove('active');
            } else {
                sidebar.classList.toggle('collapsed');
            }
        }

        toggleBtn.addEventListener('click', function () {
            toggleSidebar();
        });

        overlay.addEventListener('click', function () {
            if (window.innerWidth <= 768) {
                sidebar.classList.add('hidden-mobile');
                overlay.classList.remove('active');
            }
        });

        const currentPath = window.location.pathname;
        document.querySelectorAll('#sidebar a.nav-link').forEach(function (link) {
            const href = link.getAttribute('href');
            if (!href) return;

            if (currentPath === href || (href !== '/' && currentPath.startsWith(href))) {
                link.classList.add('active');
            }
        });

        window.addEventListener('resize', function () {
            if (window.innerWidth > 768) {
                overlay.classList.remove('active');
                sidebar.classList.remove('hidden-mobile');
            } else {
                sidebar.classList.add('hidden-mobile');
            }
        });
    });
</script>

<script>
document.addEventListener("DOMContentLoaded", function () {
  const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
  tooltipTriggerList.map(function (tooltipTriggerEl) {
    return new bootstrap.Tooltip(tooltipTriggerEl);
  });
});
</script>

</body>
</html>
